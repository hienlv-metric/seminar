<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Design API Metric Data n√¢ng c·∫•p V2</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #22d3ee;
            --accent: #f472b6;
            --dark: #0f172a;
            --dark-light: #1e293b;
            --text: #e2e8f0;
            --text-muted: #94a3b8;
            --success: #10b981;
            --warning: #f59e0b;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--dark) 0%, var(--dark-light) 100%);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Navigation */
        .nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(99, 102, 241, 0.2);
        }

        .nav-title {
            font-size: 1.25rem;
            font-weight: 600;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-dots {
            display: flex;
            gap: 0.5rem;
        }

        .nav-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--dark-light);
            border: 2px solid var(--primary);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-dot.active {
            background: var(--primary);
            box-shadow: 0 0 15px rgba(99, 102, 241, 0.5);
        }

        /* Slide Container */
        .slides-container {
            padding-top: 80px;
        }

        .slide {
            min-height: 100vh;
            padding: 4rem 6rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .slide::before {
            content: '';
            position: absolute;
            width: 600px;
            height: 600px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(99, 102, 241, 0.1) 0%, transparent 70%);
            top: -200px;
            right: -200px;
            pointer-events: none;
        }

        /* Slide Numbers */
        .slide-number {
            position: absolute;
            bottom: 2rem;
            right: 2rem;
            font-size: 4rem;
            font-weight: 700;
            color: rgba(99, 102, 241, 0.1);
        }

        /* Typography */
        h1 {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, #fff 0%, var(--text) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        h2 {
            font-size: 2.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--secondary);
        }

        h3 {
            font-size: 1.5rem;
            font-weight: 500;
            margin-bottom: 1rem;
            color: var(--primary);
        }

        p {
            font-size: 1.25rem;
            line-height: 1.8;
            color: var(--text-muted);
            max-width: 800px;
        }

        /* Cards */
        .card {
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 16px;
            padding: 2rem;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .card:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        /* Diagrams */
        .diagram-container {
            background: rgba(15, 23, 42, 0.8);
            border-radius: 20px;
            padding: 3rem;
            margin: 2rem 0;
            border: 1px solid rgba(99, 102, 241, 0.3);
        }

        .flow-diagram {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .flow-box {
            padding: 1.5rem 2rem;
            border-radius: 12px;
            font-weight: 500;
            text-align: center;
            min-width: 180px;
            position: relative;
        }

        .flow-box.client {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }

        .flow-box.server {
            background: linear-gradient(135deg, #8b5cf6, #6366f1);
        }

        .flow-box.repo {
            background: linear-gradient(135deg, #ec4899, #db2777);
        }

        .flow-box.db {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .arrow {
            font-size: 2rem;
            color: var(--secondary);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 0.5;
                transform: translateX(0);
            }

            50% {
                opacity: 1;
                transform: translateX(5px);
            }
        }

        /* Class Hierarchy */
        .hierarchy {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }

        .hierarchy-level {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .class-box {
            padding: 1rem 1.5rem;
            border-radius: 10px;
            font-family: 'Fira Code', monospace;
            font-size: 0.95rem;
            border: 2px solid;
            position: relative;
        }

        .class-box.abstract {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.2));
            border-color: var(--primary);
            box-shadow: 0 0 30px rgba(99, 102, 241, 0.2);
        }

        .class-box.concrete {
            background: rgba(30, 41, 59, 0.8);
            border-color: var(--secondary);
        }

        .class-badge {
            position: absolute;
            top: -10px;
            right: -10px;
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .class-badge.abstract {
            background: var(--primary);
        }

        .class-badge.concrete {
            background: var(--success);
        }

        .hierarchy-connector {
            width: 2px;
            height: 40px;
            background: linear-gradient(to bottom, var(--primary), var(--secondary));
            position: relative;
        }

        .hierarchy-connector::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-top: 10px solid var(--secondary);
        }

        /* Methods Grid */
        .methods-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .method-card {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .method-card:hover {
            border-color: var(--primary);
            background: rgba(30, 41, 59, 0.9);
        }

        .method-name {
            font-family: 'Fira Code', monospace;
            color: var(--secondary);
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .method-type {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
            margin-bottom: 0.75rem;
        }

        .method-type.abstract {
            background: rgba(244, 114, 182, 0.2);
            color: var(--accent);
        }

        .method-type.concrete {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }

        .method-type.static {
            background: rgba(251, 191, 36, 0.2);
            color: var(--warning);
        }

        .method-desc {
            color: var(--text-muted);
            font-size: 0.95rem;
            line-height: 1.6;
        }

        /* Tags */
        .tag {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            margin: 0.25rem;
        }

        .tag.pattern {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.3), rgba(139, 92, 246, 0.3));
            border: 1px solid var(--primary);
        }

        .tag.feature {
            background: rgba(34, 211, 238, 0.2);
            border: 1px solid var(--secondary);
        }

        /* Summary Grid */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2rem;
            margin-top: 3rem;
        }

        .summary-card {
            background: rgba(30, 41, 59, 0.6);
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            border: 1px solid rgba(99, 102, 241, 0.2);
        }

        .summary-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .summary-number {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .summary-label {
            color: var(--text-muted);
            margin-top: 0.5rem;
        }

        /* Code Block */
        .code-block {
            background: #0d1117;
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem 0;
            font-family: 'Fira Code', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
            border: 1px solid #30363d;
        }

        .code-keyword {
            color: #ff7b72;
        }

        .code-class {
            color: #f0883e;
        }

        .code-method {
            color: #d2a8ff;
        }

        .code-string {
            color: #a5d6ff;
        }

        .code-comment {
            color: #8b949e;
        }

        /* Animations */
        .fade-in {
            animation: fadeIn 0.8s ease-out forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .stagger-1 {
            animation-delay: 0.1s;
        }

        .stagger-2 {
            animation-delay: 0.2s;
        }

        .stagger-3 {
            animation-delay: 0.3s;
        }

        .stagger-4 {
            animation-delay: 0.4s;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 2rem;
            color: var(--text-muted);
            border-top: 1px solid rgba(99, 102, 241, 0.2);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .slide {
                padding: 2rem;
            }

            h1 {
                font-size: 2rem;
            }

            h2 {
                font-size: 1.75rem;
            }

            .summary-grid {
                grid-template-columns: 1fr;
            }

            .flow-diagram {
                flex-direction: column;
            }

            .arrow {
                transform: rotate(90deg);
            }
        }
    </style>
</head>

<body>
    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-title">Design API Metric Data n√¢ng c·∫•p V2</div>
        <div class="nav-dots">
            <div class="nav-dot active" data-slide="1"></div>
            <div class="nav-dot" data-slide="2"></div>
            <div class="nav-dot" data-slide="3"></div>
            <div class="nav-dot" data-slide="4"></div>
            <div class="nav-dot" data-slide="5"></div>
            <div class="nav-dot" data-slide="6"></div>
            <div class="nav-dot" data-slide="7"></div>
            <div class="nav-dot" data-slide="8"></div>
            <div class="nav-dot" data-slide="9"></div>
        </div>
    </nav>

    <div class="slides-container">
        <!-- Slide 1: Introduction -->
        <section class="slide" id="slide-1">
            <div class="slide-number">01</div>
            <h1 class="fade-in">Design API Metric Data n√¢ng c·∫•p V2</h1>
            <h2 class="fade-in stagger-1">Template Method Pattern Implementation</h2>

            <p class="fade-in stagger-2" style="margin: 2rem 0;">
                Abstract base class cung c·∫•p "skeleton" cho vi·ªác x√¢y d·ª±ng v√† th·ª±c thi c√°c query analytics
                tr√™n ClickHouse v·ªõi kh·∫£ nƒÉng caching qua Redis.
            </p>

            <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 2rem;" class="fade-in stagger-3">
                <span class="tag pattern">üéØ Template Method</span>
                <span class="tag pattern">üì¶ ABC (Abstract Base Class)</span>
                <span class="tag feature">‚ö° ClickHouse</span>
                <span class="tag feature">üîÑ Redis Caching</span>
                <span class="tag feature">üìä Pandas DataFrame</span>
            </div>

            <div class="card fade-in stagger-4" style="margin-top: 3rem; max-width: 700px;">
                <h3>üéØ M·ª•c ti√™u ki·∫øn tr√∫c</h3>
                <ul style="color: var(--text-muted); line-height: 2; margin-top: 1rem; padding-left: 1.5rem;">
                    <li>T√°ch bi·ªát logic x√¢y d·ª±ng query (abstract) v·ªõi logic th·ª±c thi (concrete)</li>
                    <li>Reuse code chung: WHERE clause, ORDER/REVENUE clause, execute query</li>
                    <li>Cho ph√©p subclass customize template SQL v√† response format</li>
                    <li>H·ªó tr·ª£ nhi·ªÅu lo·∫°i analytics: Products, Groups, Shops, Insights</li>
                </ul>
            </div>
        </section>

        <!-- Slide 2: Template Method Pattern -->
        <section class="slide" id="slide-2">
            <div class="slide-number">02</div>
            <h1 class="fade-in">Template Method Pattern</h1>
            <h2 class="fade-in stagger-1">Definition & Concept</h2>

            <div style="display: flex; gap: 2rem; margin-top: 2rem; flex-wrap: wrap;">
                <div class="card fade-in stagger-2" style="flex: 1; min-width: 300px;">
                    <h3>üìñ ƒê·ªãnh nghƒ©a</h3>
                    <p style="margin-top: 1rem; font-size: 1.1rem;">
                        Design pattern thu·ªôc nh√≥m <strong>Behavioral</strong>, ƒë·ªãnh nghƒ©a b·ªô khung (skeleton) c·ªßa m·ªôt
                        thu·∫≠t to√°n trong m·ªôt operation, tr√¨ ho√£n m·ªôt s·ªë b∆∞·ªõc xu·ªëng subclasses.
                    </p>
                    <p style="margin-top: 1rem; font-size: 1.1rem;">
                        Template Method cho ph√©p subclasses ƒë·ªãnh nghƒ©a l·∫°i c√°c b∆∞·ªõc nh·∫•t ƒë·ªãnh c·ªßa thu·∫≠t to√°n m√† kh√¥ng
                        l√†m thay ƒë·ªïi c·∫•u tr√∫c c·ªßa thu·∫≠t to√°n ƒë√≥.
                    </p>
                </div>
                <div class="card fade-in stagger-3" style="flex: 1; min-width: 300px;">
                    <h3>üîë Key Concepts</h3>
                    <ul style="color: var(--text-muted); line-height: 1.8; margin-top: 1rem; padding-left: 1.5rem;">
                        <li><strong>Abstract Class:</strong> ƒê·ªãnh nghƒ©a template method v√† c√°c primitive operations
                            (abstract methods).</li>
                        <li><strong>Concrete Class:</strong> Implement c√°c primitive operations.</li>
                        <li><strong>Hooks:</strong> C√°c method c√≥ default implementation r·ªóng ho·∫∑c ƒë∆°n gi·∫£n, subclass c√≥
                            th·ªÉ override n·∫øu c·∫ßn.</li>
                    </ul>
                </div>
            </div>

            <div class="diagram-container fade-in stagger-4"
                style="margin-top: 3rem; display: flex; justify-content: center;">
                <div
                    style="font-family: 'Fira Code', monospace; text-align: left; background: rgba(0,0,0,0.3); padding: 2rem; border-radius: 12px;">
                    <div style="color: var(--primary); font-weight: bold; margin-bottom: 0.5rem;">class AbstractClass:
                    </div>
                    <div style="padding-left: 2rem;">
                        <div style="color: var(--warning);">def template_method(self):</div>
                        <div style="padding-left: 2rem; color: var(--text-muted);">
                            self.step_one() <span style="color: #6b7280;"># common</span><br>
                            self.step_two() <span style="color: var(--accent);"># abstract</span><br>
                            self.step_three() <span style="color: #6b7280;"># hook</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Slide 3: Architecture Diagrams -->
        <section class="slide" id="slide-3">
            <div class="slide-number">03</div>
            <h1 class="fade-in">S∆° ƒë·ªì ki·∫øn tr√∫c</h1>

            <!-- 2.1 API Flow -->
            <h3 class="fade-in stagger-1" style="margin-top: 2rem;">2.1 Data Flow: Client ‚Üí Database</h3>
            <div class="diagram-container fade-in stagger-2">
                <div class="flow-diagram">
                    <div class="flow-box client">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üåê</div>
                        <div>API Client</div>
                        <div style="font-size: 0.75rem; opacity: 0.8; margin-top: 0.5rem;">HTTP Request</div>
                    </div>
                    <span class="arrow">‚Üí</span>
                    <div class="flow-box server">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">‚öôÔ∏è</div>
                        <div>FastAPI Router</div>
                        <div style="font-size: 0.75rem; opacity: 0.8; margin-top: 0.5rem;">analytics.py</div>
                    </div>
                    <span class="arrow">‚Üí</span>
                    <div class="flow-box repo">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üèóÔ∏è</div>
                        <div>Repository</div>
                        <div style="font-size: 0.75rem; opacity: 0.8; margin-top: 0.5rem;">AnalyticsSearchRepository
                        </div>
                    </div>
                    <span class="arrow">‚Üí</span>
                    <div class="flow-box db">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üóÑÔ∏è</div>
                        <div>ClickHouse</div>
                        <div style="font-size: 0.75rem; opacity: 0.8; margin-top: 0.5rem;">+ Redis Cache</div>
                    </div>
                </div>
            </div>

            <!-- 2.2 Class Hierarchy -->
            <h3 class="fade-in stagger-3" style="margin-top: 3rem;">2.2 Class Hierarchy: Template Method Pattern</h3>
            <div class="diagram-container fade-in stagger-4" style="overflow-x: auto;">
                <div class="hierarchy">
                    <!-- Abstract Base Class -->
                    <div class="hierarchy-level">
                        <div class="class-box abstract" style="min-width: 500px; padding: 1.5rem;">
                            <span class="class-badge abstract">ABC</span>
                            <div
                                style="font-weight: 700; color: var(--primary); font-size: 1.2rem; margin-bottom: 1rem;">
                                AnalyticsSearchRepository
                            </div>

                            <!-- Class Variables -->
                            <div style="margin-bottom: 0.75rem;">
                                <div
                                    style="font-size: 0.7rem; color: var(--warning); text-transform: uppercase; margin-bottom: 0.25rem;">
                                    Class Variables</div>
                                <div
                                    style="font-size: 0.8rem; color: var(--text-muted); font-family: 'Fira Code', monospace;">
                                    CATEGORIES_MAP, PLATFORMS, FIELDS_LIST_MAPPING
                                </div>
                            </div>

                            <!-- Abstract Methods -->
                            <div style="margin-bottom: 0.75rem;">
                                <div
                                    style="font-size: 0.7rem; color: var(--accent); text-transform: uppercase; margin-bottom: 0.25rem;">
                                    @abstractmethod</div>
                                <div
                                    style="font-size: 0.85rem; color: var(--accent); font-family: 'Fira Code', monospace; line-height: 1.8;">
                                    ‚Ä¢ build_template() ‚Üí str<br>
                                    ‚Ä¢ build_query_string() ‚Üí str<br>
                                    ‚Ä¢ to_response(res_df) ‚Üí dict
                                </div>
                            </div>

                            <!-- Concrete Methods -->
                            <div>
                                <div
                                    style="font-size: 0.7rem; color: var(--success); text-transform: uppercase; margin-bottom: 0.25rem;">
                                    Concrete Methods</div>
                                <div
                                    style="font-size: 0.85rem; color: var(--success); font-family: 'Fira Code', monospace; line-height: 1.8;">
                                    ‚Ä¢ __init__(ch_client, search_query, sample_rate)<br>
                                    ‚Ä¢ build_where_clause_str() ‚Üí str<br>
                                    ‚Ä¢ build_order_and_revenue_clause() ‚Üí tuple<br>
                                    ‚Ä¢ build_categories() ‚Üí tuple<br>
                                    ‚Ä¢ execute_query(cacher, use_cache_ch, ttl) ‚Üí DataFrame<br>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="hierarchy-connector"></div>

                    <div style="text-align: center; color: var(--text-muted); font-size: 0.9rem; margin: 0.5rem 0;">
                        extends ‚Üì
                    </div>

                    <!-- Subclasses -->
                    <div class="hierarchy-level"
                        style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; width: 100%; max-width: 900px;">
                        <!-- ProductsRepository -->
                        <div class="class-box concrete" style="padding: 1.25rem;">
                            <span class="class-badge concrete">Impl</span>
                            <div style="color: var(--secondary); font-weight: 600; margin-bottom: 0.75rem;">
                                AnalyticsSearchProductsRepository
                            </div>
                            <div
                                style="font-size: 0.75rem; color: var(--text-muted); font-family: 'Fira Code', monospace; line-height: 1.7;">
                                <span style="color: var(--accent);">‚ö° build_template()</span> ‚Üí PRODUCT_DETAIL_CTE<br>
                                <span style="color: var(--accent);">‚ö° build_query_string()</span><br>
                                <span style="color: var(--accent);">‚ö° to_response()</span><br>
                                <span style="color: var(--text-muted);">‚Ä¢ build_sort_by_str()</span><br>
                                <span style="color: var(--text-muted);">‚Ä¢ parse_response()</span>
                            </div>
                        </div>

                        <!-- GroupsRepository -->
                        <div class="class-box concrete" style="padding: 1.25rem;">
                            <span class="class-badge concrete">Impl</span>
                            <div style="color: var(--secondary); font-weight: 600; margin-bottom: 0.75rem;">
                                AnalyticsSearchGroupsRepository
                            </div>
                            <div
                                style="font-size: 0.75rem; color: var(--text-muted); font-family: 'Fira Code', monospace; line-height: 1.7;">
                                <span style="color: var(--accent);">‚ö° build_template()</span> ‚Üí GROUPS_CTE<br>
                                <span style="color: var(--accent);">‚ö° build_query_string()</span><br>
                                <span style="color: var(--accent);">‚ö° to_response()</span><br>
                                <span style="color: var(--text-muted);">‚Ä¢ build_sort_by_str()</span><br>
                                <span style="color: var(--text-muted);">‚Ä¢ parse_response()</span>
                            </div>
                        </div>

                        <!-- ShopsRepository -->
                        <div class="class-box concrete" style="padding: 1.25rem;">
                            <span class="class-badge concrete">Impl</span>
                            <div style="color: var(--secondary); font-weight: 600; margin-bottom: 0.75rem;">
                                AnalyticsSearchShopsRepository
                            </div>
                            <div
                                style="font-size: 0.75rem; color: var(--text-muted); font-family: 'Fira Code', monospace; line-height: 1.7;">
                                <span style="color: var(--accent);">‚ö° build_template()</span> ‚Üí SHOPS_CTE<br>
                                <span style="color: var(--accent);">‚ö° build_query_string()</span><br>
                                <span style="color: var(--accent);">‚ö° to_response()</span><br>
                                <span style="color: var(--text-muted);">‚Ä¢ build_sort_by_str()</span><br>
                                <span style="color: var(--text-muted);">‚Ä¢ parse_response()</span>
                            </div>
                        </div>

                        <!-- InsightRepository -->
                        <div class="class-box concrete" style="padding: 1.25rem;">
                            <span class="class-badge concrete">Impl</span>
                            <div style="color: var(--secondary); font-weight: 600; margin-bottom: 0.75rem;">
                                AnalyticsInsightRepository
                            </div>
                            <div
                                style="font-size: 0.75rem; color: var(--text-muted); font-family: 'Fira Code', monospace; line-height: 1.7;">
                                <span style="color: var(--accent);">‚ö° build_template()</span> ‚Üí RAW_CTE<br>
                                <span style="color: var(--accent);">‚ö° build_query_string()</span><br>
                                <span style="color: var(--accent);">‚ö° to_response()</span><br>
                                <span style="color: var(--text-muted);">‚Ä¢ build_select_clause()</span><br>
                                <span style="color: var(--text-muted);">‚Ä¢ parse_response()</span>
                            </div>
                        </div>
                    </div>

                    <!-- Legend -->
                    <div
                        style="margin-top: 1.5rem; display: flex; gap: 2rem; justify-content: center; flex-wrap: wrap;">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <span style="color: var(--accent);">‚ö°</span>
                            <span style="font-size: 0.85rem; color: var(--text-muted);">Override abstract method</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <span style="color: var(--text-muted);">‚Ä¢</span>
                            <span style="font-size: 0.85rem; color: var(--text-muted);">Additional helper method</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Slide 4: Core Methods -->
        <section class="slide" id="slide-4">
            <div class="slide-number">04</div>
            <h1 class="fade-in">C√°c ph∆∞∆°ng th·ª©c ch√≠nh</h1>

            <div class="methods-grid">
                <!-- Abstract Methods -->
                <div class="method-card fade-in stagger-1">
                    <div class="method-name">build_template()</div>
                    <span class="method-type abstract">@abstractmethod</span>
                    <p class="method-desc">
                        ƒê·ªãnh nghƒ©a SQL template v·ªõi placeholders (${order_clause}, ${where_condition}...).
                        M·ªói subclass implement template ri√™ng cho use case c·ª• th·ªÉ.
                    </p>
                </div>

                <div class="method-card fade-in stagger-2">
                    <div class="method-name">build_query_string()</div>
                    <span class="method-type abstract">@abstractmethod</span>
                    <p class="method-desc">
                        X√¢y d·ª±ng SQL query ho√†n ch·ªânh t·ª´ template b·∫±ng c√°ch replace c√°c placeholders
                        v·ªõi gi√° tr·ªã th·ª±c (order_clause, where_condition, limit, offset...).
                    </p>
                </div>

                <div class="method-card fade-in stagger-3">
                    <div class="method-name">to_response()</div>
                    <span class="method-type abstract">@abstractmethod</span>
                    <p class="method-desc">
                        Chuy·ªÉn ƒë·ªïi DataFrame result th√†nh response format ph√π h·ª£p v·ªõi API.
                        M·ªói repository c√≥ format output kh√°c nhau.
                    </p>
                </div>

                <!-- Concrete Methods -->
                <div class="method-card fade-in stagger-4">
                    <div class="method-name">build_where_clause_str()</div>
                    <span class="method-type concrete">Concrete</span>
                    <p class="method-desc">
                        X√¢y d·ª±ng WHERE clause t·ª´ search_query s·ª≠ d·ª•ng BasicQueryBuilder.
                        X·ª≠ l√Ω filters, platforms, categories, date range...
                    </p>
                </div>

                <div class="method-card fade-in stagger-1">
                    <div class="method-name">build_order_and_revenue_clause()</div>
                    <span class="method-type concrete">Concrete</span>
                    <p class="method-desc">
                        T·∫°o c√°c clause t√≠nh to√°n order_count v√† revenue theo date range.
                        H·ªó tr·ª£ precalculated columns (7d, 30d, 90d) cho performance.
                    </p>
                </div>

                <div class="method-card fade-in stagger-2">
                    <div class="method-name">execute_query()</div>
                    <span class="method-type concrete">Concrete</span>
                    <p class="method-desc">
                        Th·ª±c thi SQL query v·ªõi ClickhouseQuery client. H·ªó tr·ª£ Redis caching,
                        query cache, error handling v√† logging.
                    </p>
                </div>

                <div class="method-card fade-in stagger-3">
                    <div class="method-name">build_categories()</div>
                    <span class="method-type concrete">Concrete</span>
                    <p class="method-desc">
                        X·ª≠ l√Ω v√† chu·∫©n h√≥a categories t·ª´ input. H·ªó tr·ª£ c·∫£ platform categories
                        v√† bee_categories (cross-platform).
                    </p>
                </div>

                <div class="method-card fade-in stagger-4">
                    <div class="method-name">get_products_fields_list()</div>
                    <span class="method-type static">@staticmethod</span>
                    <p class="method-desc">
                        Map input fields sang internal column names. X·ª≠ l√Ω field dependencies
                        (shop_name ‚Üí shop_base_id, shop_username).
                    </p>
                </div>
            </div>
        </section>

        <!-- Slide 5: Execution Flow -->
        <section class="slide" id="slide-5">
            <div class="slide-number">05</div>
            <h1 class="fade-in">Execution Flow</h1>
            <h2 class="fade-in stagger-1">Sequence Diagram: Query Lifecycle</h2>

            <div class="diagram-container fade-in stagger-2" style="margin-top: 2rem;">
                <div style="display: flex; flex-direction: column; gap: 0.5rem; font-family: 'Fira Code', monospace;">
                    <!-- Step 1 -->
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div
                            style="width: 40px; height: 40px; border-radius: 50%; background: var(--primary); display: flex; align-items: center; justify-content: center; font-weight: 700;">
                            1</div>
                        <div
                            style="flex: 1; padding: 1rem; background: rgba(99, 102, 241, 0.2); border-radius: 10px; border-left: 4px solid var(--primary);">
                            <div style="color: var(--primary); font-weight: 600;">__init__(ch_client, search_query)
                            </div>
                            <div style="color: var(--text-muted); font-size: 0.9rem; margin-top: 0.25rem;">Kh·ªüi t·∫°o
                                repository, parse input parameters</div>
                        </div>
                    </div>

                    <!-- Step 2 -->
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div
                            style="width: 40px; height: 40px; border-radius: 50%; background: var(--accent); display: flex; align-items: center; justify-content: center; font-weight: 700;">
                            2</div>
                        <div
                            style="flex: 1; padding: 1rem; background: rgba(244, 114, 182, 0.2); border-radius: 10px; border-left: 4px solid var(--accent);">
                            <div style="color: var(--accent); font-weight: 600;">build_template() <span
                                    style="opacity: 0.7;">‚Üí abstract</span></div>
                            <div style="color: var(--text-muted); font-size: 0.9rem; margin-top: 0.25rem;">Subclass tr·∫£
                                v·ªÅ SQL template v·ªõi placeholders</div>
                        </div>
                    </div>

                    <!-- Step 3 -->
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div
                            style="width: 40px; height: 40px; border-radius: 50%; background: var(--secondary); display: flex; align-items: center; justify-content: center; font-weight: 700; color: var(--dark);">
                            3</div>
                        <div
                            style="flex: 1; padding: 1rem; background: rgba(34, 211, 238, 0.2); border-radius: 10px; border-left: 4px solid var(--secondary);">
                            <div style="color: var(--secondary); font-weight: 600;">build_where_clause_str() +
                                build_order_and_revenue_clause()</div>
                            <div style="color: var(--text-muted); font-size: 0.9rem; margin-top: 0.25rem;">Base class
                                x√¢y d·ª±ng WHERE, ORDER, REVENUE clauses</div>
                        </div>
                    </div>

                    <!-- Step 4 -->
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div
                            style="width: 40px; height: 40px; border-radius: 50%; background: var(--accent); display: flex; align-items: center; justify-content: center; font-weight: 700;">
                            4</div>
                        <div
                            style="flex: 1; padding: 1rem; background: rgba(244, 114, 182, 0.2); border-radius: 10px; border-left: 4px solid var(--accent);">
                            <div style="color: var(--accent); font-weight: 600;">build_query_string() <span
                                    style="opacity: 0.7;">‚Üí abstract</span></div>
                            <div style="color: var(--text-muted); font-size: 0.9rem; margin-top: 0.25rem;">Subclass
                                replace placeholders ‚Üí Final SQL query</div>
                        </div>
                    </div>

                    <!-- Step 5 -->
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div
                            style="width: 40px; height: 40px; border-radius: 50%; background: var(--success); display: flex; align-items: center; justify-content: center; font-weight: 700;">
                            5</div>
                        <div
                            style="flex: 1; padding: 1rem; background: rgba(16, 185, 129, 0.2); border-radius: 10px; border-left: 4px solid var(--success);">
                            <div style="color: var(--success); font-weight: 600;">execute_query(cacher, use_cache_ch,
                                ttl)</div>
                            <div style="color: var(--text-muted); font-size: 0.9rem; margin-top: 0.25rem;">
                                ClickhouseQuery th·ª±c thi, check Redis cache ‚Üí DataFrame</div>
                        </div>
                    </div>

                    <!-- Step 6 -->
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div
                            style="width: 40px; height: 40px; border-radius: 50%; background: var(--accent); display: flex; align-items: center; justify-content: center; font-weight: 700;">
                            6</div>
                        <div
                            style="flex: 1; padding: 1rem; background: rgba(244, 114, 182, 0.2); border-radius: 10px; border-left: 4px solid var(--accent);">
                            <div style="color: var(--accent); font-weight: 600;">to_response(res_df) <span
                                    style="opacity: 0.7;">‚Üí abstract</span></div>
                            <div style="color: var(--text-muted); font-size: 0.9rem; margin-top: 0.25rem;">Subclass
                                transform DataFrame ‚Üí API response format</div>
                        </div>
                    </div>
                </div>
            </div>

            <div style="display: flex; gap: 2rem; margin-top: 2rem; justify-content: center;" class="fade-in stagger-3">
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <div style="width: 16px; height: 16px; background: var(--accent); border-radius: 50%;"></div>
                    <span style="color: var(--text-muted);">Abstract (Subclass implement)</span>
                </div>
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <div style="width: 16px; height: 16px; background: var(--success); border-radius: 50%;"></div>
                    <span style="color: var(--text-muted);">Concrete (Base class)</span>
                </div>
            </div>
        </section>

        <!-- Slide 6: SQL Template Examples -->
        <section class="slide" id="slide-6">
            <div class="slide-number">06</div>
            <h1 class="fade-in">SQL Template Examples</h1>
            <h2 class="fade-in stagger-1">C√°ch m·ªói subclass ƒë·ªãnh nghƒ©a template</h2>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-top: 2rem;">
                <!-- Products Template -->
                <div class="card fade-in stagger-2">
                    <h3 style="color: var(--secondary); margin-bottom: 1rem;">üì¶ ProductsRepository</h3>
                    <div class="code-block" style="font-size: 0.7rem; overflow-x: auto;">
                        <pre style="margin: 0; white-space: pre;"><span class="code-comment"># build_template()</span>
CUSTOM_CTE = f"{RAW_CTE},{PRODUCT_DETAIL_CTE}"

template = <span class="code-string">'''
{CUSTOM_CTE}
<span class="code-keyword">SELECT</span> ${PRODUCT_DETAIL_SELECT_CLAUSE} 
<span class="code-keyword">FROM</span> product_detail_cte 
<span class="code-keyword">WHERE</span> order_custom > 0
<span class="code-keyword">ORDER BY</span> ${sort_by}
<span class="code-keyword">LIMIT</span> ${limit}
<span class="code-keyword">OFFSET</span> ${offset}
'''</span></pre>
                    </div>
                </div>

                <!-- Groups Template -->
                <div class="card fade-in stagger-3">
                    <h3 style="color: var(--secondary); margin-bottom: 1rem;">üìä GroupsRepository</h3>
                    <div class="code-block" style="font-size: 0.7rem; overflow-x: auto;">
                        <pre style="margin: 0; white-space: pre;"><span class="code-comment"># build_template()</span>
CUSTOM_CTE = f"{RAW_CTE},{GROUPS_CTE}"

template = <span class="code-string">'''
{CUSTOM_CTE}
<span class="code-keyword">SELECT</span> * 
<span class="code-keyword">FROM</span> groups_cte
'''</span>

<span class="code-comment"># GROUPS_CTE ch·ª©a:</span>
<span class="code-comment"># - GROUP BY bee_brand, platform_id</span>
<span class="code-comment"># - sum(order_custom), sum(revenue_custom)</span>
<span class="code-comment"># - ORDER BY sum(${sort_by})</span></pre>
                    </div>
                </div>

                <!-- Shops Template -->
                <div class="card fade-in stagger-4">
                    <h3 style="color: var(--secondary); margin-bottom: 1rem;">üè™ ShopsRepository</h3>
                    <div class="code-block" style="font-size: 0.7rem; overflow-x: auto;">
                        <pre style="margin: 0; white-space: pre;"><span class="code-comment"># build_template()</span>
CUSTOM_CTE = f"{RAW_CTE},{SHOPS_CTE}"

template = <span class="code-string">'''
{CUSTOM_CTE}  
<span class="code-keyword">SELECT</span> * <span class="code-keyword">FROM</span> shops_cte 
<span class="code-keyword">WHERE NOT</span>(shop_name <span class="code-keyword">is null or</span> trim(shop_name) = '')
<span class="code-keyword">LIMIT</span> ${limit}
<span class="code-keyword">OFFSET</span> ${offset}
'''</span>

<span class="code-comment"># SHOPS_CTE: GROUP BY shop_base_id</span></pre>
                    </div>
                </div>

                <!-- Insight Template -->
                <div class="card fade-in stagger-1">
                    <h3 style="color: var(--secondary); margin-bottom: 1rem;">üìà InsightRepository</h3>
                    <div class="code-block" style="font-size: 0.7rem; overflow-x: auto;">
                        <pre style="margin: 0; white-space: pre;"><span class="code-comment"># build_template()</span>
template = <span class="code-string">'''
{RAW_CTE}
<span class="code-keyword">SELECT</span> ${select_clause}, platform_id
<span class="code-keyword">FROM</span> raw_cte
<span class="code-keyword">GROUP BY</span> platform_id
'''</span>

<span class="code-comment"># select_clause ƒë∆∞·ª£c generate ƒë·ªông</span>
<span class="code-comment"># t·ª´ generate_intervals() v√†</span>
<span class="code-comment"># insight_search_groups filters</span></pre>
                    </div>
                </div>
            </div>

            <div class="card fade-in" style="margin-top: 1.5rem; background: rgba(99, 102, 241, 0.1);">
                <h3 style="color: var(--primary);">üí° Placeholders chung</h3>
                <div style="display: flex; flex-wrap: wrap; gap: 1rem; margin-top: 1rem;">
                    <code
                        style="padding: 0.5rem 1rem; background: var(--dark); border-radius: 8px;">${order_clause}</code>
                    <code
                        style="padding: 0.5rem 1rem; background: var(--dark); border-radius: 8px;">${revenue_clause}</code>
                    <code
                        style="padding: 0.5rem 1rem; background: var(--dark); border-radius: 8px;">${where_condition}</code>
                    <code style="padding: 0.5rem 1rem; background: var(--dark); border-radius: 8px;">${sort_by}</code>
                    <code style="padding: 0.5rem 1rem; background: var(--dark); border-radius: 8px;">${limit}</code>
                    <code style="padding: 0.5rem 1rem; background: var(--dark); border-radius: 8px;">${offset}</code>
                </div>
            </div>
        </section>

        <!-- Slide 7: Complex Query Example -->
        <section class="slide" id="slide-7">
            <div class="slide-number">07</div>
            <h1 class="fade-in">Complex Query Example</h1>
            <h2 class="fade-in stagger-1">Generated SQL from Template</h2>

            <div class="card fade-in stagger-2" style="margin-top: 2rem;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h3 style="color: var(--secondary); margin: 0;">üîç Generated SQL (Truncated)</h3>
                    <span class="tag feature" style="margin: 0;">Groups Repository</span>
                </div>
                <div class="code-block" style="font-size: 0.8rem; overflow-x: auto; max-height: 600px;">
                    <pre style="margin: 0; white-space: pre;"><span class="code-keyword">WITH</span> raw_cte <span class="code-keyword">AS</span> (
    <span class="code-keyword">SELECT</span> *,
           order_count_30d            <span class="code-keyword">AS</span> order_custom,
           order_revenue_30d          <span class="code-keyword">AS</span> revenue_custom,
           <span class="code-comment">...</span>
    <span class="code-keyword">FROM</span> analytics.products p
    <span class="code-keyword">WHERE</span> platform_id = 1 
      <span class="code-keyword">AND</span> (
          categories__id_1 <span class="code-keyword">IN</span> ('1__100635', '1__100631' <span class="code-comment">...</span>) 
          <span class="code-keyword">OR</span> categories__id_2 <span class="code-keyword">IN</span> ('1__100635', '1__100631' <span class="code-comment">...</span>) 
          <span class="code-keyword">OR</span> categories__id_3 <span class="code-keyword">IN</span> ('1__100635', '1__100631' <span class="code-comment">...</span>)
      ) 
      <span class="code-keyword">AND</span> (rating_count * 1.0 > order_count * 0.03) 
      <span class="code-keyword">AND</span> is_deleted = false 
      <span class="code-keyword">AND</span> tag <span class="code-keyword">IS NULL</span>
),
groups_cte <span class="code-keyword">AS</span> (
    <span class="code-keyword">SELECT</span> initcapUTF8(group_key)  <span class="code-keyword">AS</span> group_key,
           group_data_tuple.1      <span class="code-keyword">AS</span> platform_id,
           <span class="code-keyword">group_data_tuple.2</span>      <span class="code-keyword">AS</span> product_total,
           <span class="code-keyword">group_data_tuple.3</span>      <span class="code-keyword">AS</span> order_total_sum,
           <span class="code-keyword">group_data_tuple.4</span>      <span class="code-keyword">AS</span> revenue_total_sum,
           <span class="code-keyword">group_data_tuple.5</span>      <span class="code-keyword">AS</span> order_custom_sum,
           <span class="code-keyword">group_data_tuple.6</span>      <span class="code-keyword">AS</span> revenue_custom_sum
    <span class="code-keyword">FROM</span> (
        <span class="code-keyword">SELECT</span> group_key,
               groupArray(<span class="code-keyword">tuple</span>(platform_id, 
                                product_total, 
                                order_total_sum, 
                                revenue_total_sum, 
                                order_custom_sum, 
                                revenue_custom_sum))  <span class="code-keyword">AS</span> group_data
        <span class="code-keyword">FROM</span> (
            <span class="code-keyword">SELECT</span> bee_brand                                           <span class="code-keyword">AS</span> group_key,
                   platform_id,
                   countIf(<span class="code-keyword">DISTINCT</span> product_base_id, order_custom > 0) <span class="code-keyword">AS</span> product_total,
                   sum(order_count)                                    <span class="code-keyword">AS</span> order_total_sum,
                   sum(revenue)                                        <span class="code-keyword">AS</span> revenue_total_sum,
                   sum(order_custom)                                   <span class="code-keyword">AS</span> order_custom_sum,
                   sum(revenue_custom)                                 <span class="code-keyword">AS</span> revenue_custom_sum
            <span class="code-keyword">FROM</span> raw_cte
            <span class="code-keyword">WHERE</span> bee_brand <span class="code-keyword">IS NOT NULL</span>
              <span class="code-keyword">AND</span> trim(bee_brand) != ''
              <span class="code-keyword">AND</span> lower(trim(bee_brand)) != 'no brand' 
              <span class="code-keyword">AND</span> lower(trim(bee_brand)) != 'kh√¥ng c√≥'
            <span class="code-keyword">GROUP BY</span> platform_id, bee_brand
            <span class="code-keyword">HAVING</span> revenue_custom_sum > 0
        )
        <span class="code-keyword">GROUP BY</span> group_key
        <span class="code-keyword">ORDER BY</span> sum(-revenue_custom_sum)
        <span class="code-keyword">LIMIT</span> 20
        <span class="code-keyword">OFFSET</span> 0
    )
    ARRAY <span class="code-keyword">JOIN</span> group_data <span class="code-keyword">AS</span> group_data_tuple
)
<span class="code-keyword">SELECT</span> * <span class="code-keyword">FROM</span> groups_cte</pre>
                </div>
            </div>
        </section>

        <!-- Slide 8: Caching Strategy -->
        <section class="slide" id="slide-8">
            <div class="slide-number">08</div>
            <h1 class="fade-in">Caching Strategy</h1>
            <h2 class="fade-in stagger-1">Multi-layer caching cho performance</h2>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-top: 2rem;">
                <!-- Redis Caching -->
                <div class="card fade-in stagger-2">
                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;">
                        <div style="font-size: 3rem;">üî¥</div>
                        <div>
                            <h3 style="color: var(--accent); margin: 0;">Redis Cache</h3>
                            <span style="color: var(--text-muted);">Application-level caching</span>
                        </div>
                    </div>
                    <div class="code-block" style="font-size: 0.85rem;">
                        clickhouse_query = ClickhouseQuery(
                        ch_client,
                        <span class="code-keyword">cacher</span>=redis_instance,
                        <span class="code-keyword">use_cache_ch</span>=True,
                        <span class="code-keyword">ttl_seconds</span>=7200 <span class="code-comment"># 2 hours</span>
                        )
                        res_df, is_cached = clickhouse_query.query_df(sql)
                    </div>
                    <ul style="color: var(--text-muted); margin-top: 1rem; padding-left: 1.5rem; line-height: 1.8;">
                        <li>Cache key = hash(SQL query)</li>
                        <li>TTL configurable per request</li>
                        <li>Shared across instances</li>
                    </ul>
                </div>

                <!-- ClickHouse Query Cache -->
                <div class="card fade-in stagger-3">
                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;">
                        <div style="font-size: 3rem;">üü°</div>
                        <div>
                            <h3 style="color: var(--warning); margin: 0;">ClickHouse Query Cache</h3>
                            <span style="color: var(--text-muted);">Database-level caching</span>
                        </div>
                    </div>
                    <div class="code-block" style="font-size: 0.8rem;">
                        <span class="code-comment"># ClickHouse settings</span>
                        settings = {
                        '<span class="code-string">use_query_cache</span>': True,
                        '<span class="code-string">query_cache_ttl</span>': self.__ttl,
                        '<span class="code-string">query_cache_nondeterministic_function_handling</span>': 'save',
                        '<span class="code-string">use_query_condition_cache</span>': True
                        }
                    </div>
                    <ul
                        style="color: var(--text-muted); margin-top: 1rem; padding-left: 1.5rem; line-height: 1.6; font-size: 0.85rem;">
                        <li><strong>use_query_cache:</strong> B·∫≠t t√≠nh nƒÉng cache</li>
                        <li><strong>query_cache_ttl:</strong> Th·ªùi gian s·ªëng (e.g. 7200s)</li>
                        <li><strong>...handling:</strong> 'save' (Cache c·∫£ h√†m time/random)</li>
                        <li><strong>use_query_condition_cache:</strong> Cache theo ƒëi·ªÅu ki·ªán query</li>
                    </ul>

                    <div
                        style="margin-top: 1rem; padding: 0.75rem; background: rgba(255, 255, 255, 0.05); border-radius: 8px; font-size: 0.8rem;">
                        <div style="color: var(--warning); font-weight: 600; margin-bottom: 0.5rem;">üî• Drill-down
                            Optimization Example:</div>
                        <div style="font-family: 'Fira Code', monospace; color: var(--text-muted);">
                            1. Cache: <span style="color: var(--secondary);">SELECT * ... WHERE
                                date='2024-01-01'</span><br />
                            2. Query: <span style="color: var(--accent);">... AND shop_id=10</span><br />
                            üëâ <strong>Reuse cache</strong> & filter in memory (No DB scan)
                        </div>
                    </div>
                </div>
            </div>

            <!-- Precalculated Columns -->
            <div class="card fade-in stagger-4" style="margin-top: 2rem;">
                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                    <div style="font-size: 2rem;">‚ö°</div>
                    <h3 style="color: var(--success); margin: 0;">Precalculated Columns</h3>
                </div>
                <p style="color: var(--text-muted); margin-bottom: 1rem;">Thay v√¨ t√≠nh to√°n real-time, s·ª≠ d·ª•ng columns
                    ƒë√£ ƒë∆∞·ª£c t√≠nh s·∫µn:</p>
                <div style="display: flex; flex-wrap: wrap; gap: 1rem;">
                    <div
                        style="padding: 0.75rem 1.25rem; background: rgba(16, 185, 129, 0.2); border-radius: 8px; border: 1px solid var(--success);">
                        <code>order_count_7d</code>
                    </div>
                    <div
                        style="padding: 0.75rem 1.25rem; background: rgba(16, 185, 129, 0.2); border-radius: 8px; border: 1px solid var(--success);">
                        <code>order_count_30d</code>
                    </div>
                    <div
                        style="padding: 0.75rem 1.25rem; background: rgba(16, 185, 129, 0.2); border-radius: 8px; border: 1px solid var(--success);">
                        <code>order_count_90d</code>
                    </div>
                    <div
                        style="padding: 0.75rem 1.25rem; background: rgba(16, 185, 129, 0.2); border-radius: 8px; border: 1px solid var(--success);">
                        <code>order_revenue_7d</code>
                    </div>
                    <div
                        style="padding: 0.75rem 1.25rem; background: rgba(16, 185, 129, 0.2); border-radius: 8px; border: 1px solid var(--success);">
                        <code>order_revenue_30d</code>
                    </div>
                    <div
                        style="padding: 0.75rem 1.25rem; background: rgba(16, 185, 129, 0.2); border-radius: 8px; border: 1px solid var(--success);">
                        <code>order_revenue_90d</code>
                    </div>
                </div>
                <div class="code-block" style="margin-top: 1rem; font-size: 0.85rem;">
                    <span class="code-comment"># maybe_precalculate() checks if date range matches precalculated
                        columns</span>
                    _maybe = maybe_precalculate(PLATFORMS, platform_id, start_date, end_date)
                    <span class="code-keyword">if</span> _maybe: <span class="code-comment"># Returns 7, 30, or
                        90</span>
                    order_clause = f'order_count_{_maybe}d' <span class="code-comment"># Use precalculated</span>
                    <span class="code-keyword">else</span>:
                    order_clause = generate_order_revenue_clause(...) <span class="code-comment"># Calculate
                        dynamic</span>
                </div>
            </div>
        </section>

        <!-- Slide 9: Summary -->
        <section class="slide" id="slide-9">
            <div class="slide-number">09</div>
            <h1 class="fade-in">T·ªïng k·∫øt</h1>

            <div class="summary-grid">
                <div class="summary-card fade-in stagger-1">
                    <div class="summary-icon">üèóÔ∏è</div>
                    <div class="summary-number">4</div>
                    <div class="summary-label">Concrete Implementations</div>
                </div>
                <div class="summary-card fade-in stagger-2">
                    <div class="summary-icon">üîß</div>
                    <div class="summary-number">3</div>
                    <div class="summary-label">Abstract Methods</div>
                </div>
                <div class="summary-card fade-in stagger-3">
                    <div class="summary-icon">‚öôÔ∏è</div>
                    <div class="summary-number">5+</div>
                    <div class="summary-label">Concrete Methods</div>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-top: 3rem;">
                <div class="card fade-in stagger-4">
                    <h3 style="color: var(--success);">‚úÖ ∆Øu ƒëi·ªÉm</h3>
                    <ul style="color: var(--text-muted); line-height: 2; margin-top: 1rem; padding-left: 1.5rem;">
                        <li><strong>Code Reuse:</strong> Logic chung ƒë∆∞·ª£c implement 1 l·∫ßn</li>
                        <li><strong>Extensible:</strong> D·ªÖ d√†ng th√™m repository m·ªõi</li>
                        <li><strong>Consistent:</strong> ƒê·∫£m b·∫£o flow th·ªëng nh·∫•t</li>
                        <li><strong>Testable:</strong> C√≥ th·ªÉ test t·ª´ng ph·∫ßn ƒë·ªôc l·∫≠p</li>
                        <li><strong>Maintainable:</strong> S·ª≠a ƒë·ªïi t·∫≠p trung t·∫°i 1 ch·ªó</li>
                    </ul>
                </div>

                <div class="card fade-in stagger-4">
                    <h3 style="color: var(--warning);">üìã ƒê·∫∑c ƒëi·ªÉm Template Method</h3>
                    <ul style="color: var(--text-muted); line-height: 2; margin-top: 1rem; padding-left: 1.5rem;">
                        <li>Base class ƒë·ªãnh nghƒ©a "skeleton" algorithm</li>
                        <li>Subclass customize c√°c "hooks" c·ª• th·ªÉ</li>
                        <li>Inversion of Control: "Don't call us, we'll call you"</li>
                        <li>Thu·ªôc nh√≥m Behavioral Patterns</li>
                        <li>Ph√π h·ª£p cho c√°c workflow c√≥ steps c·ªë ƒë·ªãnh</li>
                    </ul>
                </div>
            </div>

            <div class="code-block fade-in" style="margin-top: 2rem;">
                <span class="code-comment"># Flow t·ªïng qu√°t</span>
                <span class="code-keyword">def</span> <span class="code-method">process_request</span>(repository):
                <span class="code-comment"># 1. Constructor: build template + query string</span>
                template = repository.<span class="code-method">build_template()</span> <span class="code-comment">#
                    abstract</span>
                sql = repository.<span class="code-method">build_query_string()</span> <span class="code-comment">#
                    abstract</span>

                <span class="code-comment"># 2. Execute: common logic</span>
                df = repository.<span class="code-method">execute_query()</span> <span class="code-comment">#
                    concrete</span>

                <span class="code-comment"># 3. Transform: customize output</span>
                <span class="code-keyword">return</span> repository.<span class="code-method">to_response(df)</span>
                <span class="code-comment"># abstract</span>
            </div>
        </section>
    </div>

    <footer class="footer">
        <p> Template Method Pattern Implementation ‚Ä¢ Data Platform V2 ‚Ä¢ 2025 </p>
    </footer>

    <script>
        // Navigation dots
        const dots = document.querySelectorAll('.nav-dot');
        const slides = document.querySelectorAll('.slide');

        // Update active dot on scroll
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const slideId = entry.target.id.split('-')[1];
                    dots.forEach(dot => dot.classList.remove('active'));
                    document.querySelector(`[data-slide="${slideId}"]`).classList.add('active');
                }
            });
        }, { threshold: 0.5 });

        slides.forEach(slide => observer.observe(slide));

        // Click to navigate
        dots.forEach(dot => {
            dot.addEventListener('click', () => {
                const slideId = dot.dataset.slide;
                document.getElementById(`slide-${slideId}`).scrollIntoView({ behavior: 'smooth' });
            });
        });
    </script>
</body>

</html>